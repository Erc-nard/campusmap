package com.example.campusmap.ui.map

import android.os.Build
import com.google.android.gms.maps.model.CameraPosition
import androidx.compose.runtime.Composable
import androidx.compose.runtime.getValue
import androidx.compose.runtime.mutableStateOf
import androidx.compose.runtime.remember
import androidx.compose.runtime.setValue
import androidx.compose.ui.graphics.Color
import androidx.compose.ui.Modifier
import com.google.android.gms.maps.GoogleMap
import com.google.android.gms.maps.model.LatLng
import com.google.maps.android.compose.*

// 건물 도형 데이터
data class BuildingPolygon(
    val id: String, // 건물 번호를 저장
    val points: List<LatLng>
)

@Composable
fun CampusMapScreen(
    modifier: Modifier = Modifier,
    cameraPositionState: CameraPositionState,
    mapProperties: MapProperties,
    markerPosition: LatLng
) {
    val buildings = remember {
        listOf(
            BuildingPolygon(
                id = "E3",
                points = listOf(
                    LatLng(36.36873178141499, 127.36458014303662), // 파스쿠찌 쪽 점
                    LatLng(36.3686510424991, 127.36445997947378),
                    LatLng(36.36859703238999, 127.36444022739323),
                    LatLng(36.3681362505657, 127.36482807960252),
                    LatLng(36.3679718994553, 127.36479109798243),
                    LatLng(36.36791538982127, 127.3648521199115),
                    LatLng(36.36790381052078, 127.3649551372814),
                    LatLng(36.36793967820769, 127.36501380482284),
                    LatLng(36.36816483200543, 127.36505942810854),
                    LatLng(36.368234842120614, 127.36500404064817),
                    LatLng(36.368263993639694, 127.36504874844962),
                    LatLng(36.368433403632395, 127.36490468172687),
                    LatLng(36.36840651346734, 127.36485719870774),
                    LatLng(36.36845622187289, 127.36481007332206),
                    LatLng(36.36842264100866, 127.36474027322652),
                    LatLng(36.368589763725666, 127.36460733782762),
                    LatLng(36.36861900891381, 127.36462140298373),
                    LatLng(36.36863466868382, 127.36465769068059)
                )
            ),
            BuildingPolygon(
                id = "E3-1",
                points = listOf(
//                    LatLng(36.36808783328771, 127.36518999728246),
                    LatLng(36.36800001277097, 127.36517565828161),
                    LatLng(36.367990686091034, 127.36527868624363),
                    LatLng(36.367947940612396, 127.36525898642142),
                    LatLng(36.36788585117788, 127.36567098183544),
                    LatLng(36.36794662831159, 127.3656879805336),
                    LatLng(36.36794198608103, 127.36573253026066),
                    LatLng(36.36772133834167, 127.36568692625882),
                    LatLng(36.367693706540614, 127.36588179643157),
                    LatLng(36.36793235180408, 127.36593584238993),
                    LatLng(36.36794149990958, 127.3658913137784),
                    LatLng(36.367986506713244, 127.36590823881588),
                    LatLng(36.367945212028545, 127.36615040272729),
                    LatLng(36.36813433605872, 127.36619028900203),
                    LatLng(36.36817583558858, 127.36588126810976),
                    LatLng(36.36840773066515, 127.36593249707009),
                    LatLng(36.36842612921591, 127.36581001097872), // 최북단 점
                    LatLng(36.368358891881165, 127.36569548126806),
                    LatLng(36.36813376392113, 127.36564149898568),
                    LatLng(36.368122345955676, 127.36569158855826),
                    LatLng(36.36808407224187, 127.3656830522852),
                    LatLng(36.368134795017696, 127.36530443137667),
                    LatLng(36.368094276892826, 127.36529309907871),
                    LatLng(36.3681058053952, 127.3652067956013)
                )
            ),
            BuildingPolygon(
                id = "E3-2",
                points = listOf(
                    LatLng(36.36865627460756, 127.36569687297816),
                    LatLng(36.36864724595632, 127.36570240220671),
                    LatLng(36.36883540605288, 127.36605707273004),
                    LatLng(36.368871563392915, 127.36602102737614),
                    LatLng(36.36889839333936, 127.36608801104413),
                    LatLng(36.36902710731212, 127.36599111266148),
                    LatLng(36.368791849258294, 127.36556657739354),
                    LatLng(36.36909904452107, 127.36530615338602), // 최북단
                    LatLng(36.36906544692237, 127.36524192393519),
                    LatLng(36.36908352972936, 127.3652225081618),
                    LatLng(36.36882814593424, 127.36474773748084),
                    LatLng(36.36880333001979, 127.36475876463167),
                    LatLng(36.368769740625815, 127.36469174995219),
                    LatLng(36.368647769378576, 127.36479425312272),
                    LatLng(36.3686858475005, 127.36486686018436),
                    LatLng(36.36870389621919, 127.3648585872301),
                    LatLng(36.36871734555654, 127.36488093597477),
                    LatLng(36.36868573689832, 127.36490307431767),
                    LatLng(36.36890753955832, 127.36530804386008),
                    LatLng(36.3688871782829, 127.3653358061662),
                    LatLng(36.36884459465077, 127.36526317762878),
                    LatLng(36.3687451859895, 127.36535464252036),
                    LatLng(36.36872729056892, 127.36531277269388),
                    LatLng(36.36851493865726, 127.36550121001359),
                    LatLng(36.36858432677234, 127.36564917871415),
                    LatLng(36.368672402971114, 127.36557994730408),
                    LatLng(36.368679101999305, 127.36559947883873),
                    LatLng(36.3686316547113, 127.36564382869422),
                )
            ),
            BuildingPolygon(
                id = "E3-3",
                points = listOf(
                    LatLng(36.36911742620727, 127.36666011750197), // 최북단
                    LatLng(36.368933705393275, 127.36632775106573),
                    LatLng(36.36891111660962, 127.36634714542045),
                    LatLng(36.36886405341798, 127.36626613806926),
                    LatLng(36.36882339020627, 127.36630216218401),
                    LatLng(36.36879650060247, 127.36626023930316),
                    LatLng(36.368703943843755, 127.36631553097439),
                    LatLng(36.368712878566974, 127.36634064454688),
                    LatLng(36.36867902528467, 127.36635998603131),
                    LatLng(36.368690195812, 127.36639068156846),
                    LatLng(36.36859985770498, 127.36646268720995),
                    LatLng(36.36882605820293, 127.36690111032382),
                    LatLng(36.36889606060381, 127.36684850976683),
                    LatLng(36.36890951812042, 127.36686807319612),
                    LatLng(36.368979520506265, 127.36681547255385),
                    LatLng(36.368966105742814, 127.36678198055614),
                    LatLng(36.36899094749519, 127.36676259688836),
                    LatLng(36.36900659805787, 127.36680167089548),
                    LatLng(36.36906307446884, 127.36675179240135),
                    LatLng(36.369054174036464, 127.36671553580919)
                )
            ),
            BuildingPolygon(
                id = "E3-4",
                points = listOf(
                    LatLng(36.369550931384694, 127.36635293086029), // 최북단
                    LatLng(36.36949715221004, 127.36625796250298),
                    LatLng(36.36947004910055, 127.36628012162578),
                    LatLng(36.369443202189444, 127.36621870885931),
                    LatLng(36.36946578241251, 127.36620210006645),
                    LatLng(36.36936496537122, 127.36601776700672),
                    LatLng(36.36923621723491, 127.36612580864664),
                    LatLng(36.36921609479696, 127.36607557066381),
                    LatLng(36.36925449650536, 127.36604232142032),
                    LatLng(36.36923656719332, 127.36601159405191),
                    LatLng(36.369191492142804, 127.36601695443997),
                    LatLng(36.3691735542902, 127.36598901282184),
                    LatLng(36.36910354373062, 127.36604440005382),
                    LatLng(36.36915060707007, 127.36612540752232),
                    LatLng(36.369161888639134, 127.36611988886345),
                    LatLng(36.36919103119293, 127.3661673833311),
                    LatLng(36.36906455290001, 127.36626986361422),
                    LatLng(36.36916763100309, 127.36645142112992),
                    LatLng(36.36919474268885, 127.36642647643144),
                    LatLng(36.369219345141296, 127.36648509278493),
                    LatLng(36.36919675633304, 127.36650448716414),
                    LatLng(36.369248290964535, 127.36659665903086)
                )
            ),
            BuildingPolygon(
                id = "E4",
                points = listOf(
                    LatLng(36.36769790140649, 127.36377025010822),
                    LatLng(36.36806976035682, 127.3644684112558),
                    LatLng(36.368638917889555, 127.36400306145242),
                    LatLng(36.368264786429336, 127.36331045828928)
                ),
            ),
            BuildingPolygon(
                id = "E5",
                points = listOf(
                    LatLng(36.36958689127514, 127.36343082209508), // 최북단
                    LatLng(36.36943004385222, 127.3631487299258),
                    LatLng(36.36919063512295, 127.36334540629112),
                    LatLng(36.36917211196024, 127.36350967998641),
                    LatLng(36.369113612846945, 127.36348433603025),
                    LatLng(36.36895319920365, 127.36363402044869),
                    LatLng(36.36892601177829, 127.36368403744821),
                    LatLng(36.36891453526146, 127.36375362779823),
                    LatLng(36.36894573654481, 127.36386520310883),
                    LatLng(36.36893426840827, 127.36393200773716),
                    LatLng(36.369003743353645, 127.36405211871683),
                    LatLng(36.36908506842095, 127.36398006793179),
                    LatLng(36.36912331679268, 127.36399696064065),
                    LatLng(36.36912571396606, 127.36394961392021),
                    LatLng(36.36915508651963, 127.3639218931353),
                    LatLng(36.369256390630326, 127.3639474368012),
                    LatLng(36.369313917495845, 127.36355212613931),
                    LatLng(36.36937714278481, 127.36350506225921),
                    LatLng(36.36946717400891, 127.3635333387854),
                    LatLng(36.36947161199405, 127.36355564559588),
                    LatLng(36.36950318649619, 127.36354464941434),
                    LatLng(36.36949201523868, 127.36351395395737),
                )
            ),

            BuildingPolygon(
                id = "W2-1",
                points = listOf(
                    LatLng(36.36775630117726, 127.36011009977946),
                    LatLng(36.367715984028756, 127.36003191415979),
                    LatLng(36.36769792724094, 127.36004297379793),
                    LatLng(36.36764194044973, 127.35993128762486),
                    LatLng(36.3675922759126, 127.35996448731841),
                    LatLng(36.36752953873233, 127.35984998456641),
                    LatLng(36.367466625287705, 127.35979398087211),
                    LatLng(36.36744872790356, 127.35975211298997),
                    LatLng(36.36737648406769, 127.35980192293732),
                    LatLng(36.367345094441646, 127.3597516359027),
                    LatLng(36.367207960992175, 127.35965350544568),
                    LatLng(36.367135675260364, 127.35971724357748),
                    LatLng(36.36725217174359, 127.35993506377426),
                    LatLng(36.36724764915642, 127.35994061432653),
                    LatLng(36.367489644095905, 127.36037908387301),
                    LatLng(36.36745124394084, 127.36041233516964),
                    LatLng(36.367509340274374, 127.360571388057),
                    LatLng(36.367535803257354, 127.36076093787453),
                    LatLng(36.367528447175914, 127.36095868871439),
                    LatLng(36.367505573052135, 127.36107279678079),
                    LatLng(36.36763156711696, 127.36112909304236),
                    LatLng(36.36767272541146, 127.3609287123759),
                    LatLng(36.367673213396245, 127.36076714364906),
                    LatLng(36.36764454796672, 127.36056086909981),
                    LatLng(36.36761331835988, 127.3604576539416),
                    LatLng(36.36757312746959, 127.36033768332385),
                    LatLng(36.36762510381471, 127.36028499460073),
                    LatLng(36.367452637998895, 127.35994991560474),
                    LatLng(36.36747294768005, 127.35993886635612),
                    LatLng(36.36761403250091, 127.36022087235317)
                )
            ),
            BuildingPolygon(
                id = "W8",
                points = listOf(
                    LatLng(36.37030155442772, 127.35954795479998),
                    LatLng(36.37020076061386, 127.35935248522394),
                    LatLng(36.36995462453869, 127.3595407868457),
                    LatLng(36.36996804971876, 127.35957149229289),
                    LatLng(36.369947723308485, 127.35958811348294),
                    LatLng(36.36987602449824, 127.35945685162487),
                    LatLng(36.36976986154979, 127.3595482940379),
                    LatLng(36.369893041449984, 127.35979122420488),
                    LatLng(36.369879473710476, 127.35980787644377),
                    LatLng(36.36990857682584, 127.35986929775578),
                    LatLng(36.36994470714002, 127.35984160627878),
                    LatLng(36.36995140710589, 127.35986113764848),
                    LatLng(36.36986332580489, 127.35993316239991),
                    LatLng(36.36982750597605, 127.35985778124854),
                    LatLng(36.36987041176944, 127.35982454942587),
                    LatLng(36.3697203228892, 127.35953970875211),
                    LatLng(36.36965032367611, 127.35959231643291),
                    LatLng(36.36963465398336, 127.35955881500266),
                    LatLng(36.36956014057505, 127.35961418760813),
                    LatLng(36.36956904316498, 127.35965044364512),
                    LatLng(36.36972137629464, 127.359938080094),
                    LatLng(36.369775571788274, 127.35989654301524),
                    LatLng(36.3698159057874, 127.35996915914696),
                    LatLng(36.369754917989674, 127.36002180802559),
                    LatLng(36.3698377966997, 127.36018097956303),
                    LatLng(36.370242039635414, 127.35985969034822),
                    LatLng(36.37014347407281, 127.35967258816234),
                )
            ),

            BuildingPolygon(
                id = "N11",
                points = listOf(
                    LatLng(36.374065455200686, 127.35904709209814), // 최북단의 최서단
                    LatLng(36.374013638523465, 127.35904685396419),
                    LatLng(36.37401608397941, 127.35898278874637),
                    LatLng(36.37390343065532, 127.35898505704868),
                    LatLng(36.373899067160266, 127.35893767621072),
                    LatLng(36.373567899354896, 127.3589333688292),
                    LatLng(36.37357072146024, 127.3594933511086),
                    LatLng(36.37401004514717, 127.35949258667365),
                    LatLng(36.37401282605755, 127.35931708570749),
                    LatLng(36.37406464273324, 127.35931732402068),
                )
            ),
            BuildingPolygon(
                id = "N12",
                points = listOf(
                    LatLng(36.3743202323757, 127.35973081919266), // 최북단의 최서단
                    LatLng(36.374286447283346, 127.35972787768682),
                    LatLng(36.374286648593944, 127.35966101599439),
                    LatLng(36.37425285511238, 127.35966086042278),
                    LatLng(36.374250627374764, 127.3596524923436),
                    LatLng(36.374081676737525, 127.3596461427144),
                    LatLng(36.3740786687659, 127.35989686302194),
                    LatLng(36.37396375414146, 127.3599019055212),
                    LatLng(36.37396623361994, 127.35982669680543),
                    LatLng(36.37403607348373, 127.35982701846527),
                    LatLng(36.37403688710353, 127.35955678665668),
                    LatLng(36.37381834752304, 127.35955856681932),
                    LatLng(36.373822341734495, 127.35972852668262),
                    LatLng(36.373750248968506, 127.3597281947401),
                    LatLng(36.37374746745745, 127.35990369509673),
                    LatLng(36.373900664581235, 127.35990440081999),
                    LatLng(36.37389594054981, 127.35997681319945),
                    LatLng(36.37428570042985, 127.35997582312368),
                    LatLng(36.3742903069566, 127.35994241303794),
                    LatLng(36.37431508884219, 127.35994252721324),
                )
            ),
            BuildingPolygon(
                id = "N14",
                points = listOf(
                    LatLng(36.37389890478544, 127.35824119327827),
                    LatLng(36.373871878348176, 127.35823828342451),
                    LatLng(36.37387257149841, 127.35800705459134),
                    LatLng(36.373843283807055, 127.35800692038463),
                    LatLng(36.373841122737296, 127.3579762652877),
                    LatLng(36.373782547353926, 127.35797599689789),
                    LatLng(36.37378020262518, 127.3580066313247),
                    LatLng(36.373719374342016, 127.35800635258919),
                    LatLng(36.373718413838965, 127.35832672925787),
                    LatLng(36.373641823617845, 127.35832359206341),
                    LatLng(36.373633852639294, 127.358727513804),
                    LatLng(36.37379604465175, 127.3587338303688),
                    LatLng(36.37379692266529, 127.35844131226386),
                    LatLng(36.37389379733231, 127.35844175671697),
                )
            ),
            BuildingPolygon(
                id = "N16",
                points = listOf(
                    LatLng(36.37394869393994, 127.3574140001945),
                    LatLng(36.373849566363454, 127.35741354670839),
                    LatLng(36.37384367411883, 127.35712378335555),
                    LatLng(36.37369274650213, 127.35711752161721),
                    LatLng(36.373689277061196, 127.35752425028092),
                    LatLng(36.373770373106, 127.3575274073137),
                    LatLng(36.37376943892021, 127.35783942655037),
                    LatLng(36.37371084684601, 127.35784473003162),
                    LatLng(36.37371042953008, 127.3579840242245),
                    LatLng(36.37381405455341, 127.35798728496547),
                    LatLng(36.37382112208453, 127.35788423808644),
                    LatLng(36.373870694216286, 127.35788167923802),
                    LatLng(36.37387530850218, 127.35784548331134),
                    LatLng(36.37391585234589, 127.35784845494366),
                    LatLng(36.37391655308171, 127.3576144400792),
                    LatLng(36.373945840773956, 127.35761457413912),
                )
            ),
            BuildingPolygon(
                id = "N19",
                points = listOf(
                    LatLng(36.374199725256275, 127.35633977591883),
//                    LatLng(),
//                    LatLng(),
//                    LatLng(),
//                    LatLng(),
//                    LatLng(),
//                    LatLng(),
//                    LatLng(),
                )
            )
        )
    }

    var selectedBuildingId by remember { mutableStateOf<String?>(null) }

    GoogleMap(
        modifier = modifier,
        cameraPositionState = cameraPositionState,
        properties = mapProperties,
        onMapClick = {
            selectedBuildingId = null
        }
    ) {
        Marker(
            state = MarkerState(position = markerPosition),
            title = "Marker"
        )
        buildings.forEach { building ->
            val isSelected = selectedBuildingId == building.id
            val buildingColor = when (building.id[0]) {
                'E' -> Color(239, 153, 37)
                'W' -> Color(111, 182, 70)
                'N' -> Color(223, 52, 48)
                else -> Color.Black
            }
            Polygon(
                points = building.points,
                fillColor = if (isSelected) buildingColor.copy(0.25f) else buildingColor.copy(0.1f),
                strokeColor = if (isSelected) buildingColor else Color.Transparent,
                strokeWidth = 3f,
                clickable = true,
                onClick = {
                    selectedBuildingId = building.id
                }
            )
        }
    }
}
